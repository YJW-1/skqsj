{"version":3,"sources":["assets\\script\\Game\\laser.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { cocosz } from \"../Framework/CocosZ\";\r\nimport Constant, { tag } from \"../Framework/Constant\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class laser extends cc.Component {\r\n\r\n\r\n    laserEffect: cc.Node = null;\r\n    isDes: boolean = false;\r\n    onRayCast() {\r\n        if (this.isDes) return;\r\n        let startPos = this.node.parent.convertToWorldSpaceAR(this.node.getPosition());\r\n        let endPos = cc.v2(0, 0);\r\n        if (cocosz.dataMgr.CurLevelId == 71 || cocosz.dataMgr.CurLevelId == 79 || cocosz.dataMgr.CurLevelId == 87 ||\r\n            cocosz.dataMgr.CurLevelId == 90 || cocosz.dataMgr.CurLevelId == 95 || cocosz.dataMgr.CurLevelId == 96) {\r\n            if (cocosz.dataMgr.CurLevelId == 95) {\r\n                if (this.node.parent.angle != 180) {\r\n                    this.node.parent.angle = 270;\r\n                }\r\n            }\r\n            else if (cocosz.dataMgr.CurLevelId == 96) {\r\n                if (this.node.parent.angle != 0) {\r\n                    this.node.parent.angle = 270;\r\n                }\r\n            }\r\n            else {\r\n                this.node.parent.angle = 270;\r\n            }\r\n        }\r\n        if (this.node.parent.angle == 0) {\r\n            endPos = cc.v2(startPos.x + 1500, startPos.y);\r\n        }\r\n        else if (this.node.parent.angle == 180) {\r\n            endPos = cc.v2(startPos.x - 1500, startPos.y);\r\n        }\r\n        else if (this.node.parent.angle == 90) {\r\n            endPos = cc.v2(startPos.x, startPos.y + 1500);\r\n        }\r\n        else if (this.node.parent.angle == 270) {\r\n            endPos = cc.v2(startPos.x, startPos.y - 1500);\r\n        }\r\n        let result = cocosz.gameMgr.onRayCast(startPos, endPos);\r\n        // cc.log(this.node.parent.angle, startPos.x, startPos.y, endPos.x, endPos.y, result[0].collider.node.name);\r\n\r\n        for (let rb of result) {\r\n            let CTag = rb.collider.tag;\r\n            let node = rb.collider.node;\r\n            if (CTag == 0 || CTag == tag.moveFloor || CTag == tag.stone || CTag == tag.stone3 || CTag == tag.cloud || (CTag == tag.floorThorn && node.name == \"floor19\")) {\r\n                let point = rb.point;\r\n                let w = startPos.x - point.x;\r\n                if (this.node.parent.angle == 90 || this.node.parent.angle == 270) {\r\n                    w = startPos.y - point.y;\r\n                }\r\n                this.node.width = Math.abs(w) / this.node.parent.scaleX;\r\n                this.laserEffect.x = this.node.width + 45 + 7\r\n                return;\r\n            }\r\n            else if (CTag == tag.balloon || CTag == tag.rope || CTag == tag.player) {\r\n                if (CTag == tag.balloon && node.parent.parent.name == \"role\") {\r\n                    let sc = node.getComponent(\"balloon\");\r\n                    sc.onDesByLaser();\r\n                }\r\n                else if (CTag == tag.rope) {\r\n                    let sc = node.getChildByName(\"balloon\").getComponent(\"balloon\");\r\n                    sc.onDesByLaser();\r\n                }\r\n                else if (CTag == tag.player) {\r\n                    let parent = node.parent;\r\n                    if (parent.name != \"role\") {\r\n                        parent = parent.parent;\r\n                    }\r\n                    for (let child of node.parent.children) {\r\n                        if (child.name == \"right_balloon\" || child.name == \"left_balloon\") continue;\r\n                        child.color = cc.color(0, 0, 0, 255);\r\n                        for (let child2 of child.children) {\r\n                            child2.color = cc.color(0, 0, 0, 255);\r\n                            if (child.children.length > 0) {\r\n                                for (let child3 of child2.children) {\r\n                                    child3.color = cc.color(0, 0, 0, 255);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    cc.game.emit(Constant.E_GAME_FAID)\r\n                }\r\n            }\r\n            else if (CTag == tag.thorn || (CTag == tag.floorThorn && node.name != \"floor19\") || CTag == tag.honeybee) {\r\n                let point = rb.point;\r\n                let pos = this.node.parent.convertToNodeSpaceAR(point);\r\n                let prefab = cocosz.resMgr.getRes(\"laserEffect\", cc.Prefab);\r\n                let node2 = cc.instantiate(prefab);\r\n                node2.setPosition(pos);\r\n                this.node.parent.addChild(node2);\r\n                node.destroy();\r\n            }\r\n            else if (CTag == tag.balloon2) {\r\n                node.destroy();\r\n            }\r\n            else if (CTag == tag.laser) {\r\n                cc.log(\"激光销毁--------------------\")\r\n                if (cocosz.dataMgr.CurLevelId == 135) return;\r\n                cc.log(\"激光销毁2--------------------\")\r\n                this.isDes = true;\r\n                this.scheduleOnce(() => {\r\n                    this.node.parent.destroy();\r\n                }, 0.1)\r\n            }\r\n        }\r\n        this.node.width = 1975;\r\n    }\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onEnable() {\r\n        let box = this.node.parent.getComponent(cc.PhysicsBoxCollider);\r\n        box.apply();\r\n    }\r\n    onDestroy() {\r\n        cc.log(\"激光销毁----\")\r\n    }\r\n\r\n    onLoad() {\r\n        this.laserEffect = this.node.parent.getChildByName(\"laserEffect\");\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(dt) {\r\n        this.onRayCast();\r\n    }\r\n}\r\n"]}