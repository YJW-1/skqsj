{"version":3,"sources":["assets\\resources\\SDK\\scripts\\FaceBookManager.js"],"names":["FaceBookManager","cc","Class","require","properties","videoID","init","obj","_super","loadVideo","getHaveVideo","FBVideoId","getSysPlatform_string","getSysPlatform","shareHelp","share","FBInstant","shareAsync","intent","image","getImgBase64","text","player","getName","data","myReplayData","then","success","target","find","width","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","canvas","document","createElement","ctx","getContext","_renderType","game","RENDER_TYPE_CANVAS","texture","getSprite","getTexture","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","toDataURL","self","getRewardedVideoAsync","rewarded","loadAsync","showRewardedVideoAd","id","closeCallBack","showAsync","showSpotByBegin","isHaveNative","top","showMySpot","showSpotByPause","showSpotByFinish","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["let FaceBookManager = cc.Class({\r\n\textends: require('BaseManager'),\r\n    properties:{\r\n        videoID:null,\r\n    },\r\n    init: function(obj){\r\n        this._super();\r\n        this.loadVideo();\r\n        \r\n        // FB.init({\r\n        //     appId            : '216568438988937',\r\n        //     autoLogAppEvents : true,\r\n        //     status           : true,\r\n        //     xfbml            : true,\r\n        //     version          : 'v2.9'\r\n        // });\r\n    },\r\n    getHaveVideo(){\r\n        if(FBVideoId != \"\"){\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n    getSysPlatform_string(){\r\n\t\treturn 'faceBook';\r\n    },\r\n    getSysPlatform(){\r\n\t\treturn 2;\r\n\t},\r\n    shareHelp(){},\r\n\r\n    // 分享功能\r\n    share (obj) {\r\n        FBInstant.shareAsync({\r\n            intent: 'SHARE',//SHARE   REQUEST  INVITE   CHALLENGE\r\n            image: this.getImgBase64(),\r\n            text: FBInstant.player.getName() + 'is asking for your help!',\r\n            data: {myReplayData: '...'},\r\n        }).then(function(){\r\n            // continue with the game.\r\n            if(obj && obj.success){\r\n                obj.success(1);\r\n            }\r\n        });\r\n    },\r\n\r\n    // 截屏返回 iamge base6，用于 Share\r\n    getImgBase64 () {\r\n        let target = cc.find('Canvas');\r\n        let width = 960, height = 1280;\r\n        let renderTexture = new cc.RenderTexture(width, height);\r\n        renderTexture.begin();\r\n        target._sgNode.visit();\r\n        renderTexture.end();\r\n        //\r\n        let canvas = document.createElement('canvas');\r\n        let ctx = canvas.getContext('2d');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            let texture = renderTexture.getSprite().getTexture();\r\n            let image = texture.getHtmlElementObj();\r\n            ctx.drawImage(image, 0, 0);\r\n        }\r\n        else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\r\n            let buffer = gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\r\n            let texture = renderTexture.getSprite().getTexture()._glID;\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n            let data = new Uint8Array(width * height * 4);\r\n            gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            let rowBytes = width * 4;\r\n            for (let row = 0; row < height; row++) {\r\n                let srow = height - 1 - row;\r\n                let data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\r\n                let imageData = new ImageData(data2, width, 1);\r\n                ctx.putImageData(imageData, 0, row);\r\n            }\r\n        }\r\n        return canvas.toDataURL('image/png');\r\n    },\r\n    /**\r\n     * 观看视频 id 没用到 closeCallBack 看完视频回调\r\n     */\r\n    //lieyou_SdkManager.addToast(cc.find(\"Canvas\"),res);\r\n    loadVideo(){\r\n        var self = this;\r\n        FBInstant.getRewardedVideoAsync(\r\n            FBVideoId, // Your Ad Placement Id\r\n          ).then(function(rewarded) {\r\n            // Load the Ad asynchronously\r\n            self.videoID = rewarded;\r\n            return self.videoID.loadAsync();\r\n          })\r\n    },\r\n    showRewardedVideoAd(id,closeCallBack){\r\n        \r\n        var self = this;\r\n        if(this.videoID) {\r\n            var id = this.videoID;\r\n            this.videoID = null;\r\n            id.showAsync().then(function() {\r\n                closeCallBack(true);\r\n                self.loadVideo();\r\n            })\r\n        }else{\r\n            self.loadVideo();\r\n        }\r\n    },\r\n    showSpotByBegin: function(isHaveNative,top){\r\n\t\tthis.showMySpot();\r\n\t},\r\n\tshowSpotByPause: function(isHaveNative,top){\r\n\r\n\t\t// var num = Userdefault.getIntForKey(\"showBannerByPauseNum\");\r\n\t\t// Userdefault.setDataForKey(\"showBannerByPauseNum\",num+1);\r\n\r\n\t\t// if((num - 3)%3 == 0) {\r\n\t\t\tthis.showMySpot();\r\n\t\t// }\r\n\t\t\r\n\t},\r\n    showSpotByFinish: function(isHaveNative,top){\r\n\t\t// var num = Userdefault.getIntForKey(\"showBannerByFinishNum\");\r\n\t\t// Userdefault.setDataForKey(\"showBannerByFinishNum\",num+1);\r\n\t\t\r\n\t\t// if((num - 3)%3 == 0) {\r\n\t\t\tthis.showMySpot();\r\n\t\t// }\r\n\t\t\r\n    },\r\n    showMySpot(){\r\n        var self = this;\r\n        if(this.videoID) {\r\n            var id = this.videoID;\r\n            this.videoID = null;\r\n            id.showAsync().then(function() {\r\n                self.loadVideo();\r\n            })\r\n        }else{\r\n            self.loadVideo();\r\n        }\r\n\t},\r\n})\r\n\r\nmodule.exports = FaceBookManager;\r\n\r\n\r\n"]}